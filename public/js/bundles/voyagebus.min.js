function GetVoyagesByDate(n, t, i) {
    var r = {
        Nereden: $("#nereden").val(),
        Nereye: $("#nereye").val(),
        NeredenText: $("#NeredenText").val(),
        NeredenRegion: $("#NeredenRegion").val(),
        NereyeText: $("#NereyeText").val(),
        NereyeRegion: $("#NereyeRegion").val(),
        SessionData: $("#seatSessionData").val(),
        CurrentDate: n,
        isDonus: t,
        isNext: i
    };
    $.blockUI(blockUICss);
    $.ajax({
        type: "POST",
        url: "/" + lang + "/Bus/RefreshVoyageList",
        data: r,
        success: function(n) {
            $.unblockUI();
            t ? ($("#voyageReturn").html(""),
            $("#voyageReturn").html(n)) : ($("#voyageDeparture").html(""),
            $("#voyageDeparture").html(n))
        }
    })
}
function goToByScroll() {
    var n = document.getElementById(selectedVoyageIdTest).scrollTop
      , t = $(n).scrollTop()
}
function ChangeVoyage(n, t, i, r, u, f) {
    if (console.log({
        isDonus: r
    }),
    r == "True" || r == !0) {
        if ($("#seatGidisSeferId").val() && !returnVoyageDateTimeControl($("#gidisSeferTarihi").val(), t))
            return !1;
        $("#seatDonusSeferId").val(n);
        $("#donusSeferTarihi").val(t);
        $("#EntegreDonusSaat").val("");
        $("#EntegreDonusSaat").val(f);
        $("#IsDirectDonus").val("");
        $("#IsDirectDonus").val(u);
        $("#koltuk-kart-donus-hidden td[name='secilenKoltuk']").remove()
    } else {
        if ($("#seatDonusSeferId").val() && !returnVoyageDateTimeControl(t, $("#donusSeferTarihi").val()))
            return !1;
        $("#seatGidisSeferId").val(n);
        $("#gidisSeferTarihi").val(t);
        $("#EntegreGidisSaat").val("");
        $("#EntegreGidisSaat").val(f);
        $("#IsDirectGidis").val("");
        $("#IsDirectGidis").val(u);
        $("#koltuk-kart-gidis-hidden td[name='secilenKoltuk']").remove()
    }
    var e = "#voyageDiv_" + n;
    if ($(e).hasClass("selectedVoyage")) {
        $(e).removeClass("selectedVoyage");
        $(".seatPlan_" + n).html("");
        return
    }
    GetSeatPlan(n, i, r)
}
function GetSeatPlan(n, t, i) {
    i == "True" || i == !0 ? $(".toVoyage").removeClass("selectedVoyage") : $(".fromVoyage").removeClass("selectedVoyage");
    $.blockUI(blockUICss);
    $.ajax({
        "async": !1,
        type: "POST",
        url: "/" + lang + "/Bus/GetSeatPlan",
        data: {
            SeferId: n,
            Salon: t,
            SessionId: sessionId,
            isDonus: i,
            KoltukListesi: []
        },
        success: function(t) {
            $.unblockUI();
            i == "True" || i == !0 ? $(".seatPlanAreaReturn").html("") : $(".seatPlanAreaDeparture").html("");
            $("#voyageDiv_" + n).addClass("selectedVoyage");
            selectedVoyageIdTest = "selectedVoyages_" + n;
            $(".seatPlan_" + n).html(t)
        },
        error: function(n) {
            $.unblockUI();
            console.log(n)
        }
    })
}
function SelectSeat(n, t, i) {
    var r = t == "True" || t == !0 ? $("#seatDonusSeferId").val() : $("#seatGidisSeferId").val()
      , u = $(".seatPlan_" + r + " .activeHallCode").val();
    $("#koltukNo").html("");
    $("#koltukNo").html(n);
    $("#manBtn").attr("onclick", "");
    $("#manBtn").attr("onclick", "CinsiyetPopup('" + n + "', '" + t + "', '" + i + "', 'True', 'False');");
    $("#womanBtn").attr("onclick", "");
    $("#womanBtn").attr("onclick", "CinsiyetPopup('" + n + "', '" + t + "', '" + i + "', 'False', 'False');");
    $("#cinsiyetModal").modal("show")
}
function ContinueWithSelection(n, t, i) {
    var h = "", y, p, u, r;
    if (i == "False") {
        if (h = GetSeatsInBasket(n, i),
        donusTarihi && donusOnay && gidisSecilenKoltukSayisi != donusSecilenKoltukSayisi)
            return ShowErrorMessage(differenceDepartureReturnSeat),
            !1;
        if ($("#ChangeId").val() && gidisSecilenKoltukSayisi != parseInt($("#koltukSayisi").val()))
            return ShowErrorMessage(changeSeatsGreat),
            !1;
        var c = !0
          , k = 0
          , d = 0;
        for (YedekTiklanan = [],
        YedekBosTekKoltuklar = [],
        YedekTiklanan = JSON.parse(JSON.stringify(tiklananKoltuklar)),
        YedekBosTekKoltuklar = JSON.parse(JSON.stringify(BosTekKoltuklar)),
        r = 0; r < tiklananKoltuklar.length; r++) {
            for (u = 0; u < BosTekKoltuklar.length; u++)
                r > -1 && u > -1 && tiklananKoltuklar[r].koltukNo == BosTekKoltuklar[u].koltukNo && (tiklananKoltuklar.splice(r, 1),
                r--,
                BosTekKoltuklar.splice(u, 1),
                u--);
            for (u = r + 1; u < tiklananKoltuklar.length; u++)
                r > -1 && u > -1 && tiklananKoltuklar[r].sira == tiklananKoltuklar[u].sira && (harfler.indexOf(tiklananKoltuklar[r].harfKodu) == harfler.indexOf(tiklananKoltuklar[u].harfKodu) + 1 || harfler.indexOf(tiklananKoltuklar[r].harfKodu) == harfler.indexOf(tiklananKoltuklar[u].harfKodu) - 1) && (tiklananKoltuklar.splice(r, 1),
                r--,
                u--,
                tiklananKoltuklar.splice(u, 1))
        }
        var a = 0
          , v = 0
          , f = "";
        for (r = 0; r < tiklananKoltuklar.length; r++)
            for (u = 0; u < BosTekKoltuklar.length; u++)
                if (tiklananKoltuklar[r].cinsiyet == BosTekKoltuklar[u].cinsiyet && (tiklananKoltuklar[r].cinsiyet == "True" ? v++ : a++,
                v >= 2 || a >= 2)) {
                    f += tiklananKoltuklar[r].cinsiyet;
                    c = !1;
                    break
                }
        for (a = 0,
        v = 0,
        r = 0; r < tiklananKoltuklar.length; r++)
            tiklananKoltuklar[r].cinsiyet == "False" && k++,
            tiklananKoltuklar[r].cinsiyet == "True" && d++;
        if (k > 2 && (f += "False",
        c = !1),
        d > 2 && (f += "True",
        c = !1),
        tiklananKoltuklar = JSON.parse(JSON.stringify(YedekTiklanan)),
        BosTekKoltuklar = JSON.parse(JSON.stringify(YedekBosTekKoltuklar)),
        !c)
            return lang == "tr" ? f.includes("True") == !0 && f.includes("False") == !1 ? (ShowErrorMessage("Lütfen müsait olan bay yanı koltuklardan seçiniz."),
            !1) : f.includes("False") == !0 && f.includes("True") == !1 ? (ShowErrorMessage("Lütfen müsait olan bayan yanı koltuklardan seçiniz."),
            !1) : (ShowErrorMessage("Lütfen müsait olan bay yanı ve bayan yanı koltuklardan seçiniz."),
            !1) : (ShowErrorMessage("Please select another seat.!"),
            !1);
        $(".fromVoyage").hide();
        $(".seatPlan_" + n).html();
        $(".SelectedFromVoyage").append('<div id="selectedVoyages_' + n + '" class="fromToVoyagesList">');
        $(".SelectedFromVoyage").append($("#voyageDiv_" + n + " .row").html());
        $(".SelectedFromVoyage").append("<\/div>");
        $(".SelectedFromVoyage .selectSeatText").html('<a class="selectSeatTextNew" href="javascript:void(0)" onclick="ChangeSelectionFrom(\'' + n + "')\">" + changeSelectionTxt + "<\/a>");
        $("#gidisActiveHallId").val(t);
        $(".SelectedFromVoyage .selectedSeatNumber").html(h);
        $(".SelectedFromVoyage .voyagePageSeat").show();
        gidisOnay = !0;
        gidisOnay && donusOnay && SessionKontrol()
    } else {
        if (h = GetSeatsInBasket(n, i),
        gidisOnay && gidisSecilenKoltukSayisi != donusSecilenKoltukSayisi)
            return ShowErrorMessage(differenceDepartureReturnSeat),
            !1;
        var l = !0
          , o = 0
          , s = 0;
        if (YedekTiklananDonus = [],
        YedekBosTekKoltuklarDonus = [],
        gidisOnay) {
            for (y = 0,
            p = 0,
            r = 0; r < tiklananKoltuklar.length; r++)
                tiklananKoltuklar[r].cinsiyet == "False" ? y++ : p++;
            for (r = 0; r < tiklananKoltuklarDonus.length; r++)
                tiklananKoltuklarDonus[r].cinsiyet == "False" ? o++ : s++;
            if (y != o && p != s)
                return ShowErrorMessage("Gidiş ve dönüş seferindeki seçilen cinsiyetler eşit değildir."),
                !1
        }
        for (o = 0,
        s = 0,
        YedekTiklananDonus = JSON.parse(JSON.stringify(tiklananKoltuklarDonus)),
        YedekBosTekKoltuklarDonus = JSON.parse(JSON.stringify(BosTekKoltuklarDonus)),
        r = 0; r < tiklananKoltuklarDonus.length; r++) {
            for (u = 0; u < BosTekKoltuklarDonus.length; u++)
                r > -1 && u > -1 && tiklananKoltuklarDonus[r].koltukNo == BosTekKoltuklarDonus[u].koltukNo && (tiklananKoltuklarDonus.splice(r, 1),
                r--,
                BosTekKoltuklarDonus.splice(u, 1),
                u--);
            for (u = r + 1; u < tiklananKoltuklarDonus.length; u++)
                r > -1 && u > -1 && tiklananKoltuklarDonus[r].sira == tiklananKoltuklarDonus[u].sira && (harflerDonus.indexOf(tiklananKoltuklarDonus[r].harfKodu) == harflerDonus.indexOf(tiklananKoltuklarDonus[u].harfKodu) + 1 || harflerDonus.indexOf(tiklananKoltuklarDonus[r].harfKodu) == harflerDonus.indexOf(tiklananKoltuklarDonus[u].harfKodu) - 1) && (tiklananKoltuklarDonus.splice(r, 1),
                r--,
                u--,
                tiklananKoltuklarDonus.splice(u, 1))
        }
        var w = 0
          , b = 0
          , e = "";
        for (r = 0; r < tiklananKoltuklarDonus.length; r++)
            for (u = 0; u < BosTekKoltuklarDonus.length; u++)
                if (tiklananKoltuklarDonus[r].cinsiyet == BosTekKoltuklarDonus[u].cinsiyet && (tiklananKoltuklarDonus[r].cinsiyet == "True" ? b++ : w++,
                b >= 2 || w >= 2)) {
                    e += tiklananKoltuklarDonus[r].cinsiyet;
                    l = !1;
                    break
                }
        for (w = 0,
        b = 0,
        r = 0; r < tiklananKoltuklarDonus.length; r++)
            tiklananKoltuklarDonus[r].cinsiyet == "False" && o++,
            tiklananKoltuklarDonus[r].cinsiyet == "True" && s++;
        if (o > 2 ? (e += "False",
        l = !1) : s > 2 && (e += "True",
        l = !1),
        tiklananKoltuklarDonus = JSON.parse(JSON.stringify(YedekTiklananDonus)),
        BosTekKoltuklarDonus = JSON.parse(JSON.stringify(YedekBosTekKoltuklarDonus)),
        !l)
            return lang == "tr" ? e.includes("True") == !0 && e.includes("False") == !1 ? (ShowErrorMessage("Lütfen dönüş için müsait olan bay yanı koltuklardan seçiniz."),
            !1) : e.includes("False") == !0 && e.includes("True") == !1 ? (ShowErrorMessage("Lütfen dönüş için müsait olan bayan yanı koltuklardan seçiniz."),
            !1) : (ShowErrorMessage("Lütfen dönüş için müsait olan bay yanı ve bayan yanı koltuklardan seçiniz."),
            !1) : (ShowErrorMessage("Please select another seat.!"),
            !1);
        $(".toVoyage").hide();
        $(".SelectedToVoyage").append('<div class="fromToVoyagesList">');
        $(".SelectedToVoyage").append($("#voyageDiv_" + n + " .row").html());
        $(".SelectedToVoyage").append("<\/div>");
        $(".SelectedToVoyage .selectSeatText").html('<a class="selectSeatTextNew" href="javascript:void(0)" onclick="ChangeSelectionTo(\'' + n + "')\">" + changeSelectionTxt + "<\/a>");
        $("#donusActiveHallId").val(t);
        $(".SelectedToVoyage .selectedSeatNumber").html(h);
        $(".SelectedToVoyage .voyagePageSeat").show();
        donusOnay = !0;
        gidisOnay && donusOnay && SessionKontrol()
    }
    window.location.href = "#"
}
function GetSeatsInBasket(n, t) {
    $.blockUI(blockUICss);
    var i = "";
    return $.ajax({
        "async": !1,
        type: "POST",
        url: "/" + lang + "/Bus/GetSeatsInBasket",
        data: {
            SeferId: n,
            SessionId: sessionId,
            isDonus: t
        },
        success: function(n) {
            $.unblockUI();
            var r = [];
            $.each(n, function(n, t) {
                r.push(t.koltukKodu)
            });
            t == "False" ? gidisSecilenKoltukSayisi = n.length : donusSecilenKoltukSayisi = n.length;
            i = r.join(", ")
        },
        error: function(n) {
            $.unblockUI();
            console.log(n)
        }
    }),
    i
}
function ChangeSelectionFrom(n) {
    $(".SelectedFromVoyage").html("");
    $(".fromVoyage").show();
    $(".seatPlan_" + n).html("");
    $(".SelectedFromVoyage .selectedSeatNumber").html("");
    $(".SelectedFromVoyage .voyagePageSeat").hide();
    gidisOnay = !1
}
function ChangeSelectionTo(n) {
    $(".SelectedToVoyage").html("");
    $(".toVoyage").show();
    $(".seatPlan_" + n).html("");
    $(".SelectedToVoyage .selectedSeatNumber").html("");
    $(".SelectedToVoyage .voyagePageSeat").hide();
    donusOnay = !1
}
function SessionKontrol() {
    if ($.blockUI(blockUICss),
    !returnVoyageDateTimeControl($("#gidisSeferTarihi").val(), $("#donusSeferTarihi").val()))
        return !1;
    if (!$("#seatGidisSeferId").val())
        return ShowErrorMessage(noDepartureTxt),
        !1;
    if (!$("#seatDonusSeferId").val() && donusTarihi)
        return ShowErrorMessage(noReturnTxt),
        !1;
    $("#selectedDepartureSeats").val($(".SelectedFromVoyage .selectedSeatNumber").html());
    $("#selectedReturnSeats").val($(".SelectedToVoyage .selectedSeatNumber").html());
    $("#postVoyage").submit()
}
function returnVoyageDateTimeControl(n, t) {
    if (donusTarihi) {
        var i = dateFormat(n)
          , r = dateFormat(t);
        if (i.date > r.date)
            return ShowErrorMessage(greatReturnDate),
            $.unblockUI(),
            !1;
        if (i.date.getTime() == r.date.getTime()) {
            if (i.time >= r.time)
                return ShowErrorMessage(greatTime),
                $.unblockUI(),
                !1;
            if (i.time.setHours(i.time.getHours() + 2) > r.time)
                return ShowErrorMessage(MinTwoHour),
                $.unblockUI(),
                !1
        }
    }
    return !0
}
function CinsiyetPopup(n, t, i, r, u) {
    var f = t == "True" || t == !0 ? $("#seatDonusSeferId").val() : $("#seatGidisSeferId").val()
      , e = $(".seatPlan_" + f + " .activeHallCode").val();
    $.blockUI(blockUICss);
    $.ajax({
        "async": !1,
        type: "POST",
        url: "/" + lang + "/Bus/SaveSeatNumber",
        data: {
            KoltukNo: n,
            SeferId: f,
            SessionId: sessionId,
            isDonus: t,
            KoltukKodu: i,
            Cinsiyet: r,
            Platform: 1,
            OSInfo: 3
        },
        success: function(o) {
            $.unblockUI();
            $("#cinsiyetModal").modal("hide");
            o.operation == "Error" && ShowErrorMessage(o.errorDescription);
            GetSeatPlan(f, e, t);
            o.operation != "Error" && addToCard(n, t, i, r, u)
        },
        error: function(n) {
            $("#cinsiyetModal").modal("hide");
            $.unblockUI();
            console.log(n)
        }
    })
}
function addToCard(n, t, i, r, u) {
    t == "False" ? u == "True" ? ($("#koltuk-kart-gidis-hidden").find("#koltuk_" + n).remove(),
    $("#koltuk-kart-gidis").html($("#koltuk-kart-gidis-hidden").html())) : (r == "False" ? $("#koltuk-kart-gidis-hidden").append('<td id="koltuk_' + n + '" name="secilenKoltuk"><div class="disabledSeatK seatSize seattdDiv"><h6 style="margin-bottom: .0rem;font-size:0.8rem;">' + n + '<\/h6><img height="19" width="15" style="margin-top: -2px;" src="../../img/bus/kbeyaz.png"><\/div><\/td>') : $("#koltuk-kart-gidis-hidden").append('<td id="koltuk_' + n + '" name="secilenKoltuk"><div class="disabledSeat seatSize seattdDiv"><h6 style="margin-bottom: .0rem;font-size:0.8rem;">' + n + '<\/h6><img height="19" width="15" style="margin-top: -2px;" src="../../img/bus/ebeyaz.png"><\/div><\/td>'),
    $("#koltuk-kart-gidis").html($("#koltuk-kart-gidis-hidden").html())) : u == "True" ? ($("#koltuk-kart-donus-hidden").find("#koltuk_" + n).remove(),
    $("#koltuk-kart-donus").html($("#koltuk-kart-donus-hidden").html())) : (r == "False" ? $("#koltuk-kart-donus-hidden").append('<td id="koltuk_' + n + '" name="secilenKoltuk"><div class="disabledSeatK seatSize seattdDiv"><h6 style="margin-bottom: .0rem;font-size:0.8rem;">' + n + '<\/h6><img height="19" width="15" style="margin-top: -2px;" src="../../img/bus/kbeyaz.png"><\/div><\/td>') : $("#koltuk-kart-donus-hidden").append('<td id="koltuk_' + n + '" name="secilenKoltuk"><div class="disabledSeat seatSize seattdDiv"><h6 style="margin-bottom: .0rem;font-size:0.8rem;">' + n + '<\/h6><img height="19" width="15" style="margin-top: -2px;" src="../../img/bus/ebeyaz.png"><\/div><\/td>'),
    $("#koltuk-kart-donus").html($("#koltuk-kart-donus-hidden").html()))
}
$(function() {
    $(window).scroll(function() {
        var n = this;
        $.each($(".acceptSeatButton"), function(t) {
            var i = $(this).attr("rel");
            (!gidisOnay && t == 0 || t > 0) && ($(n).scrollTop() + $(window).height() > $("#voyageDiv_" + i).offset().top + $("#voyageDiv_" + i).height() ? $("#voyageDiv_" + i + " .acceptSeatButton").css({
                "margin-bottom": "0px",
                position: "relative"
            }) : $(n).scrollTop() + $(window).height() < $("#voyageDiv_" + i).offset().top + 90 ? ($("#voyageDiv_" + i + " .acceptSeatButton").css({
                "margin-bottom": "0px",
                position: "relative"
            }),
            $("#voyageDiv_" + i).css({
                "padding-bottom": "0px"
            })) : $("#voyageDiv_" + i + " .acceptSeatButton").css({
                "margin-bottom": "0px",
                position: "fixed",
                bottom: "0px",
                width: $("#voyageDiv_" + i).width()
            }))
        })
    })
});
var selectedVoyageIdTest;
